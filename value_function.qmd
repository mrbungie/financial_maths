# Value Function

## Introduction

So far, we've learned to describe cashflows as discrete events (money at specific times). But to truly understand the **financial state** of a project or investment at *any* point in time, we need a continuous view. This is where the **value function** comes in.

::: {.callout-tip icon="true"}
## Intuition: From Snapshots to a Movie

-   **Cashflow table**: Snapshots at specific moments
-   **Value function**: A continuous movie showing your financial position over time

Think of it as tracking your "net worth from this investment" at every instant, not just when money moves.
:::

## The Core Concept

::: {.callout-caution icon=true}
## References

**Book:** Pearson Corporate Finance 6th Edition, Chapter 3 (Present Value and NPV Decision Rule), Page 74, [Direct Link](https://cdn.jsdelivr.net/gh/mrbungie/financial_maths@main/resources/books/pearson_corporate_finance_6th.pdf#page=107)

**Slide:** Financial Mathematics Slides 1-96, Slides 33-36 (Value function definition), Page 33, [Direct Link](https://cdn.jsdelivr.net/gh/mrbungie/financial_maths@main/resources/slideshows/25_09_30_FinancialMathematics_Slides_1_96.pdf#page=33)

**Slide:** Financial Mathematics Slides 1-96, Slides 38-41 (Value function and cash flows examples), Page 38, [Direct Link](https://cdn.jsdelivr.net/gh/mrbungie/financial_maths@main/resources/slideshows/25_09_30_FinancialMathematics_Slides_1_96.pdf#page=38)

NOTE: There is nothing about "Value Function" in the book itself, as it is a more complex abstraction than the ones normally used in Finance. It is actually useful notation if you get it (i.e. your background is in engineering, statistics, math, etc), but **just don't bother looking it up online.**
:::

::: {.callout-note icon="true"}
## Definition: Value Function

The **value function** $V(t)$ represents the monetary value of a cashflow stream at time $t$, accounting for all past and future cashflows, adjusted for the time value of money.

$$
V(t) = \text{value at time } t \text{ of everything that has happened and will happen}
$$
:::

### Two Perspectives on $V(t)$

1.  **Backward-looking**: What happened before $t$, accumulated to time $t$
2.  **Forward-looking**: What will happen after $t$, discounted to time $t$

## Value Function and Cash Flows: A Detailed Example

::: {.callout-note icon="true"}
## Important Distinction

The **value function** of a financial transaction and its **cash flows** are two different concepts. To see this clearly, let's examine an investment/borrowing operation in detail.
:::

### The Investment Operation

Consider the following financial transaction representing either an investment or borrowing operation:

$$
\{1000, -380, -380, -380\} / \{0, 1, 2, 3\}
$$

This means:
-   **t = 0**: Receive or invest 1,000€
-   **t = 1**: Pay 380€
-   **t = 2**: Pay 380€  
-   **t = 3**: Pay 380€

### Cashflow Table

| Time (quarters) | Cashflow (€) | Type    | Description |
|-----------------|--------------|---------|-------------|
| 0               | +1,000       | Inflow  | Loan received / Investment |
| 1               | −380         | Outflow | Payment     |
| 2               | −380         | Outflow | Payment     |
| 3               | −380         | Outflow | Payment     |

\FloatBarrier

### Timeline Diagram

```{=latex}
\begin{figure}[h]
\centering
\begin{tikzpicture}[scale=1.2]
% Time axis
\draw[thick,->] (0,0) -- (13,0) node[right] {Time (quarters)};
\foreach \x/\label in {0/0, 4/1, 8/2, 12/3}
    \draw (\x,0.1) -- (\x,-0.1) node[below] {$t=\label$};

% Inflow at t=0
\draw[->,green!60!black,very thick] (0,-1.2) -- (0,0.5);
\node[above,green!60!black,font=\small] at (0,0.7) {+1{,}000€};
\node[below,green!60!black,font=\scriptsize] at (0,-1.5) {Loan received};

% Outflow at t=1
\draw[->,red!70!black,very thick] (4,0.5) -- (4,-1.2);
\node[above,red!70!black,font=\small] at (4,0.7) {−380€};
\node[below,red!70!black,font=\scriptsize] at (4,-1.5) {Payment};

% Outflow at t=2
\draw[->,red!70!black,very thick] (8,0.5) -- (8,-1.2);
\node[above,red!70!black,font=\small] at (8,0.7) {−380€};
\node[below,red!70!black,font=\scriptsize] at (8,-1.5) {Payment};

% Outflow at t=3
\draw[->,red!70!black,very thick] (12,0.5) -- (12,-1.2);
\node[above,red!70!black,font=\small] at (12,0.7) {−380€};
\node[below,red!70!black,font=\scriptsize] at (12,-1.5) {Payment};

% Starting date annotation
\node[font=\scriptsize,blue] at (6,1.5) {Starting: 31/12/2024};
\end{tikzpicture}
\end{figure}
```

\FloatBarrier

::: {.callout-tip icon="true"}
## Interpretation

If you **receive** 1,000€ initially, this is a **borrowing** operation (you're taking a loan).  
If you **invest** 1,000€ initially, think of the negative sign meaning you place money, and the positive payments are your returns.

For this example, we'll treat it as a **borrowing operation** where you borrow 1,000€ and make three payments of 380€.
:::

### Decomposing the Interest

Let's suppose that interest is described by **Decomposition 1**, with the cashflows decomposed as:

$$
\{1000, -333.33-46.67, -333.33-46.67, -333.34-46.66\} / \{0, 1, 2, 3\}
$$

This decomposition separates each payment into **principal repayment** and **interest payment**:

| Time | Total Payment (€) | Principal (€) | Interest (€) |
|------|-------------------|---------------|--------------|
| 0    | +1,000            | —             | —            |
| 1    | −380              | −333.33       | −46.67       |
| 2    | −380              | −333.33       | −46.67       |
| 3    | −380              | −333.34       | −46.66       |

\FloatBarrier

For the sake of brevity, let's measure time in **quarters**, starting from 31/12/2024. From this decomposition, we can compute the following **period interest rates**:

$$
i_1 = 0.047; \quad i_2 = 0.070; \quad i_3 = 0.140
$$

::: {.callout-note icon="true"}
## Computing Period Interest Rates

The period interest rate $i_k$ represents the interest accrued during period $k$:

- **Period 1**: Interest = 46.67€ on 1,000€ principal → $i_1 = 46.67/1000 = 0.047$
- **Period 2**: Interest = 46.67€ on 1,000€ principal → $i_2 = 0.070$ (needs accumulated capital)
- **Period 3**: Interest = 46.66€ on accumulated capital → $i_3 = 0.140$
:::

### Building the Value Function

We can now use these rates to build a **composite operation** of the same type we've used to introduce the value function.

#### At Time 0: Initial Investment

The investment consists of 1,000€ at time 0. Therefore:

$$
V(0) = 1,000
$$

#### At Time 1: After First Period

At time 1, since the period interest rate is $i_1 = 0.047$, the period interest is 46.67€. The borrower can decide to **repay the entire debt**, or to **extend the payment** term by another quarter, paying an additional interest.

If they choose the **second option**, the composite transaction becomes:

$$
\{1,000, -1,046.67\} / \{1, 046.67, -1,046.67 + I_2\}
$$

Now, what is the interest pertaining to the second period? To preserve coherence with interest rate $i_2$, it must be:

$$
I_2 = 1,046.67 \times i_2 = 73.27
$$

Therefore, the composite transaction becomes:

$$
\{1,000, -1,046.67\} / \{0, 1\} \oplus \{1,046.67, -1,119.43\} / \{0, 1\}
$$

The symbol $\oplus$ means we're **combining** or **composing** these operations. We now have the second point of the value function:

$$
V(0) = 1,000; \quad V(1) = 1,046.67
$$

#### At Time 2 and 3: Continuing the Process

We can **repeat the same procedure**: holding the period interest rates fixed and supposing to delay the principal payment until time 3, we find the remaining points of the value function:

$$
V(2) = 1,119.93; \quad V(3) = 1,276.72
$$

### The Value Function Graph (Decomposition 1)

```{=latex}
\begin{figure}[h]
\centering
\begin{tikzpicture}[scale=1.3]
% Axes
\draw[->] (-0.5,0) -- (10,0) node[right] {Time ($t$)};
\draw[->] (0,0) -- (0,5) node[above] {Value (€)};

% Y-axis labels
\foreach \y/\label in {0/0, 2/1{,}000, 3/1{,}200, 4/1{,}400}
    \draw (-0.1,\y) -- (0.1,\y) node[left=3pt,font=\small] {\label};

% Time labels
\foreach \x/\label in {0/0, 3/1, 6/2, 9/3}
    \draw (\x,0.1) -- (\x,-0.1) node[below] {$\label$};

% Value function points (scaled: 1000->2, 1046.67->2.093, 1119.93->2.24, 1276.72->2.55)
\fill[red] (0,2) circle (3pt);
\fill[red] (3,2.093) circle (3pt);
\fill[red] (6,2.24) circle (3pt);
\fill[red] (9,2.553) circle (3pt);

% Lines connecting points
\draw[thick,red] (0,2) -- (3,2.093) -- (6,2.24) -- (9,2.553);

% Value labels
\node[above right,red,font=\small] at (0,2) {1{,}000};
\node[above right,red,font=\small] at (3,2.093) {1{,}046.67};
\node[above right,red,font=\small] at (6,2.24) {1{,}119.93};
\node[above right,red,font=\small] at (9,2.553) {1{,}276.72};

\end{tikzpicture}
\end{figure}
```

\FloatBarrier

::: {.callout-tip icon="true"}
## Reading the Graph

-   **The value function grows over time** — the debt accumulates with interest
-   Starting from 1,000€, it grows to 1,276.72€ by time 3
-   The growth rate **accelerates** over time (notice $i_3 = 0.140$ is much higher than $i_1 = 0.047$)
-   This represents the **accumulated capital** if no payments are made
:::

### Comparing with Decomposition 2

What happens if we repeat the same procedure using **Decomposition 2**?

$$
\{1000, -370-10, -370-10, -260-120\} / \{0, 1, 2, 3\}
$$

This alternative decomposition has a **different structure** of principal and interest:

| Time | Total Payment (€) | Principal (€) | Interest (€) |
|------|-------------------|---------------|--------------|
| 0    | +1,000            | —             | —            |
| 1    | −380              | −370          | −10          |
| 2    | −380              | −370          | −10          |
| 3    | −380              | −260          | −120         |

\FloatBarrier

Notice that in Decomposition 2, **more principal is paid early**, but the **interest in period 3 is much higher** (120€ vs 46.66€).

From this decomposition, we compute different period interest rates:

$$
i_1 = 0.010; \quad i_2 = 0.016; \quad i_3 = 0.462
$$

Following the same procedure as before, we obtain:

$$
V(0) = 1,000; \quad V(1) = 1,010; \quad V(2) = 1,026.16; \quad V(3) = 1,500.25
$$

### Comparing Both Decompositions

```{=latex}
\begin{figure}[h]
\centering
\begin{tikzpicture}[scale=1.3]
% Axes
\draw[->] (-0.5,0) -- (10,0) node[right] {Time ($t$)};
\draw[->] (0,0) -- (0,5.5) node[above] {Value (€)};

% Y-axis labels
\foreach \y/\label in {0/0, 2/1{,}000, 3/1{,}200, 4/1{,}400, 5/1{,}600}
    \draw (-0.1,\y) -- (0.1,\y) node[left=3pt,font=\small] {\label};

% Time labels
\foreach \x/\label in {0/0, 3/1, 6/2, 9/3}
    \draw (\x,0.1) -- (\x,-0.1) node[below] {$\label$};

% Decomposition 1 (red)
\fill[red] (0,2) circle (3pt);
\fill[red] (3,2.093) circle (3pt);
\fill[red] (6,2.24) circle (3pt);
\fill[red] (9,2.553) circle (3pt);
\draw[thick,red] (0,2) -- (3,2.093) -- (6,2.24) -- (9,2.553);

% Decomposition 2 (blue)
\fill[blue] (0,2) circle (3pt);
\fill[blue] (3,2.02) circle (3pt);
\fill[blue] (6,2.052) circle (3pt);
\fill[blue] (9,3.0) circle (3pt);
\draw[thick,blue] (0,2) -- (3,2.02) -- (6,2.052) -- (9,3.0);

% Legend
\node[red,font=\small] at (7,4.5) {Decomposition 1};
\node[blue,font=\small] at (7,4) {Decomposition 2};

\end{tikzpicture}
\end{figure}
```

\FloatBarrier

::: {.callout-important icon="true"}
## Key Observations

Comparing the two decompositions:

1. **Both start at the same point**: $V(0) = 1,000$ for both
2. **Decomposition 1** (red): Grows steadily with moderate interest rates
   - More balanced growth across all periods
   - Final value: 1,276.72€
3. **Decomposition 2** (blue): Grows slowly at first, then dramatically in period 3
   - Very low interest rates in periods 1 and 2
   - Extremely high interest rate in period 3 ($i_3 = 0.462$ or 46.2%!)
   - Final value: 1,500.25€ (much higher!)

**Same cashflows, different interest rate structures** lead to different value functions!
:::

## The Value Function Formula

::: {.callout-important icon="true"}
## Key Formula: Value Function

For a cashflow stream with payments $C_0, C_1, ..., C_n$ at times $t_0, t_1, ..., t_n$:

$$
V(t) = \sum_{t_i \leq t} C_i \cdot (1+i)^{t-t_i} + \sum_{t_j > t} \frac{C_j}{(1+i)^{t_j - t}}
$$

Where: 

- First sum: Past cashflows accumulated forward to time $t$ 
- Second sum: Future cashflows discounted back to time $t$ 
- $i$ = interest rate per period

NOTE: $\sum$ means summation. You can read more about that in the maths cheat sheet.
:::

**In words**: \> Value at time $t$ = (Everything before $t$, grown with interest) + (Everything after $t$, discounted)

## Net Present Value (NPV)

::: {.callout-caution icon=true}
## References

**Book:** Pearson Corporate Finance 6th Edition, Chapter 3 (NPV and Investment Decisions), Page 80, [Direct Link](https://cdn.jsdelivr.net/gh/mrbungie/financial_maths@main/resources/books/pearson_corporate_finance_6th.pdf#page=113)

**Slide:** Financial Mathematics Slides 1-96, Slide 35 (NPV formula and decision rule), Page 35, [Direct Link](https://cdn.jsdelivr.net/gh/mrbungie/financial_maths@main/resources/slideshows/25_09_30_FinancialMathematics_Slides_1_96.pdf#page=35)
:::

The value at time zero, $V(0)$, has a special name:

::: {.callout-note icon="true"}
## Definition: Net Present Value

The **Net Present Value (NPV)** is the value function evaluated at $t=0$:

$$
\text{NPV} = V(0) = \sum_{i=0}^{n} \frac{C_i}{(1+r)^{t_i}}
$$

It represents the "today value" of the entire cashflow stream.
:::

### Decision Rule

::: {.callout-important icon="true"}
## NPV Decision Rule

-   **NPV \> 0**: Project adds value → **Accept**
-   **NPV = 0**: Project is break-even → **Indifferent**
-   **NPV \< 0**: Project destroys value → **Reject**
:::

### Example: Should We Accept This Investment?

**Investment opportunity**:

- Initial cost: \$5,000
- Year 1 return: \$2,000
- Year 2 return: \$2,500
- Year 3 return: \$1,800
- Discount rate: 10%

**Calculate NPV**:
$$
\begin{aligned}
\text{NPV} &= -5000 + \frac{2000}{1.10} + \frac{2500}{1.10^2} + \frac{1800}{1.10^3} \\
&= -5000 + 1818.18 + 2066.12 + 1352.42 \\
&= 236.72
\end{aligned}
$$

**Decision**: **Accept!** NPV = $236.72$ \> 0, so the project adds value.

## Value Function Properties

### Property 1: Additivity

If you have two independent cashflow streams $A$ and $B$:

$$
V_{A+B}(t) = V_A(t) + V_B(t)
$$

You can value them separately and add the results.

### Property 2: Time Consistency

The value function satisfies:

$$
V(t_2) = V(t_1) \cdot (1+i)^{t_2-t_1} + \sum_{t_1 < t_i \leq t_2} C_i \cdot (1+i)^{t_2-t_i}
$$

**Interpretation**: Value at $t_2$ = (Value at $t_1$ grown with interest) + (Cashflows in between, accumulated)

### Property 3: Boundary Conditions

-   **At start**: $V(0)$ = NPV
-   **At end**: $V(T)$ = all cashflows accumulated to final time

## Practical Applications

### 1. Project Monitoring

Track $V(t)$ over time to see if your project is on track:

```{=latex}
\begin{figure}[h]
\centering
\begin{tikzpicture}[scale=1.0]
% Axes
\draw[->] (0,0) -- (10,0) node[right] {Time};
\draw[->] (0,-2) -- (0,3) node[above] {Value};

% Planned trajectory
\draw[thick,blue,dashed] (0,0.5) -- (2,-0.5) -- (4,0.2) -- (6,1) -- (8,1.6) -- (10,2);
\node[blue] at (10,2.5) {Planned $V(t)$};

% Actual trajectory
\draw[thick,red] (0,0.5) -- (2,-0.3) -- (4,0.4) -- (6,1.2) -- (8,1.9);
\node[red] at (8,2.5) {Actual $V(t)$};

% Current time
\draw[thick,dashed] (8,-2) -- (8,3);
\node[below] at (8,-2) {Today};

% Annotation
\node[green!50!black,font=\small] at (7,1.5) {Ahead of plan! ✓};
\end{tikzpicture}
\end{figure}
```

\FloatBarrier

If actual $V(t)$ \> planned $V(t)$, you're ahead of schedule!

### 2. Comparing Investments

Two projects with different cashflow patterns:

| Time | Project A | Project B |
|------|-----------|-----------|
| 0    | −1,000    | −1,000    |
| 1    | +1,200    | 0         |
| 2    | 0         | +1,300    |

**At 10% discount rate**: - $\text{NPV}_A = -1000 + 1200/1.10 = 90.91$ - $\text{NPV}_B = -1000 + 1300/1.10^2 = 74.38$

**Conclusion**: Project A is better (higher NPV).

## Summary

✅ **Value function** $V(t)$ = financial position at any time $t$\
✅ **Combines** past (accumulated) and future (discounted) cashflows\
✅ **NPV** = $V(0)$ = value at the start\
✅ **Decision rule**: Accept if NPV \> 0\
✅ **Tells a story**: Smoothed continuous view of wealth over time\
✅ **Practical use**: Monitor projects, compare investments

::: {.callout-important icon="true"}
## Key Insight

The value function transforms **discrete cashflows** (jumps) into a **continuous financial narrative** (smooth story). It's the "bank account balance" of the investment at every moment.
:::

::: {.callout-caution icon=true}
## References

**Book:** Pearson Corporate Finance 6th Edition, Chapter 3 (Present Value and NPV Decision Rule), Page 74, [Direct Link](https://cdn.jsdelivr.net/gh/mrbungie/financial_maths@main/resources/books/pearson_corporate_finance_6th.pdf#page=107)

**Slide:** Financial Mathematics Slides 1-96, Slides 33-36 (Value function definition, properties, examples), Page 33, [Direct Link](https://cdn.jsdelivr.net/gh/mrbungie/financial_maths@main/resources/slideshows/25_09_30_FinancialMathematics_Slides_1_96.pdf#page=33)
:::

------------------------------------------------------------------------

**Next**: In [Chapter 4: Interest & Discount Rates](interest_rates.qmd), we'll dive deep into how interest rates drive the time value of money.